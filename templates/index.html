<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AJ Content Engine</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg-primary:#0a0a0f;--bg-card:#141420;--bg-card-hover:#1c1c30;--accent:#e50914;--accent-glow:rgba(229,9,20,.35);--accent-secondary:#00d4ff;--text-primary:#f1f1f1;--text-secondary:#8b8ba3;--text-muted:#55556a;--border:#1e1e30;--gradient-hero:linear-gradient(180deg,transparent 0%,var(--bg-primary) 100%)}
*{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}body{font-family:'DM Sans',sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{height:6px;width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#333;border-radius:3px}::-webkit-scrollbar-thumb:hover{background:#555}
.topnav{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:16px 48px;background:linear-gradient(180deg,rgba(10,10,15,.95) 0%,rgba(10,10,15,.7) 70%,transparent 100%);backdrop-filter:blur(12px);transition:background .3s}.topnav.scrolled{background:rgba(10,10,15,.97)}.logo{font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:3px;color:var(--accent);text-decoration:none}.logo span{color:var(--text-primary)}.nav-links{display:flex;gap:28px;align-items:center}.nav-links a{color:var(--text-secondary);text-decoration:none;font-size:.9rem;font-weight:500;transition:color .2s;position:relative}.nav-links a:hover{color:var(--text-primary)}.nav-links a.active{color:var(--text-primary)}.nav-links a.active::after{content:'';position:absolute;bottom:-4px;left:0;right:0;height:2px;background:var(--accent);border-radius:1px}
.hero{position:relative;padding:140px 48px 60px;min-height:480px;background:radial-gradient(ellipse at 20% 50%,rgba(229,9,20,.08) 0%,transparent 50%),radial-gradient(ellipse at 80% 30%,rgba(0,212,255,.05) 0%,transparent 50%),var(--bg-primary);overflow:hidden}.hero::after{content:'';position:absolute;bottom:0;left:0;right:0;height:120px;background:var(--gradient-hero)}.hero-content{position:relative;z-index:2;max-width:680px}.hero-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 14px;border-radius:20px;background:rgba(229,9,20,.12);border:1px solid rgba(229,9,20,.25);font-size:.75rem;font-weight:600;color:var(--accent);letter-spacing:1px;text-transform:uppercase;margin-bottom:20px}.hero-badge .dot{width:6px;height:6px;border-radius:50%;background:var(--accent);animation:pulse 2s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}.hero h1{font-family:'Bebas Neue',sans-serif;font-size:4.2rem;line-height:1;letter-spacing:2px;margin-bottom:16px}.hero h1 .red{color:var(--accent)}.hero p{color:var(--text-secondary);font-size:1.15rem;line-height:1.6;margin-bottom:32px;max-width:560px}
.manual-input{display:flex;gap:12px;align-items:center;background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:6px 6px 6px 20px;max-width:580px}.manual-input input{flex:1;background:transparent;border:none;outline:none;color:var(--text-primary);font-size:1rem;font-family:inherit}.manual-input input::placeholder{color:var(--text-muted)}.btn-generate{padding:12px 24px;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;font-size:.9rem;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:inherit}.btn-generate:hover{background:#ff1a25;box-shadow:0 0 24px var(--accent-glow);transform:translateY(-1px)}
.feed-section{padding:20px 0 40px;position:relative;z-index:2}.section-header{display:flex;justify-content:space-between;align-items:center;padding:0 48px;margin-bottom:16px}.section-title{font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:1.5px;display:flex;align-items:center;gap:12px}.section-title .icon{font-size:1.2rem}.section-title .count{font-family:'DM Sans',sans-serif;font-size:.7rem;font-weight:600;color:var(--accent);background:rgba(229,9,20,.12);padding:3px 10px;border-radius:10px;letter-spacing:.5px}
.scroll-row{display:flex;gap:16px;overflow-x:auto;padding:8px 48px 20px;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;scrollbar-width:thin}.scroll-row::-webkit-scrollbar{height:4px}
.topic-card{flex:0 0 340px;min-height:260px;background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:0;overflow:hidden;cursor:pointer;scroll-snap-align:start;transition:all .3s cubic-bezier(.25,.46,.45,.94);position:relative;display:flex;flex-direction:column}.topic-card:hover{transform:scale(1.04);border-color:rgba(229,9,20,.3);box-shadow:0 12px 40px rgba(0,0,0,.5),0 0 20px var(--accent-glow);z-index:10}
.card-image{width:100%;height:140px;object-fit:cover;background:linear-gradient(135deg,#1a1a2e 0%,#0f0f1a 100%);position:relative;overflow:hidden}.card-image img{width:100%;height:100%;object-fit:cover}.card-image .placeholder{width:100%;height:100%;background:linear-gradient(135deg,#1c1c30 0%,#12121f 50%,#1a1028 100%);display:flex;align-items:center;justify-content:center;font-size:2.5rem;opacity:.3}.card-gradient{position:absolute;bottom:0;left:0;right:0;height:60px;background:linear-gradient(transparent,var(--bg-card))}.card-source-badge{position:absolute;top:12px;left:12px;padding:4px 10px;border-radius:6px;font-size:.65rem;font-weight:700;letter-spacing:.5px;text-transform:uppercase;backdrop-filter:blur(8px)}
.source-serper{background:rgba(66,133,244,.25);color:#8ab4f8;border:1px solid rgba(66,133,244,.3)}.source-reddit{background:rgba(255,69,0,.25);color:#ff6b35;border:1px solid rgba(255,69,0,.3)}.source-hackernews{background:rgba(255,102,0,.25);color:#ff8c42;border:1px solid rgba(255,102,0,.3)}.source-rss{background:rgba(0,212,255,.2);color:var(--accent-secondary);border:1px solid rgba(0,212,255,.3)}.source-twitter{background:rgba(29,155,240,.25);color:#1d9bf0;border:1px solid rgba(29,155,240,.3)}.source-producthunt{background:rgba(218,85,47,.25);color:#da552f;border:1px solid rgba(218,85,47,.3)}.source-arxiv{background:rgba(179,31,36,.25);color:#e84142;border:1px solid rgba(179,31,36,.3)}
.card-score{position:absolute;top:12px;right:12px;padding:4px 8px;border-radius:6px;font-size:.7rem;font-weight:700;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);color:var(--accent);display:flex;align-items:center;gap:4px}
.card-body{padding:16px 18px;flex:1;display:flex;flex-direction:column}.card-title{font-weight:700;font-size:.95rem;line-height:1.4;margin-bottom:8px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;color:var(--text-primary)}.card-meta{font-size:.75rem;color:var(--text-muted);margin-bottom:12px;display:flex;align-items:center;gap:8px}.card-why{font-size:.8rem;color:var(--text-secondary);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;flex:1}.card-actions{display:flex;gap:8px;margin-top:14px}.btn-card{flex:1;padding:10px 14px;border:none;border-radius:8px;font-size:.78rem;font-weight:700;cursor:pointer;transition:all .2s;font-family:inherit;letter-spacing:.3px}.btn-campaign{background:var(--accent);color:#fff}.btn-campaign:hover{background:#ff1a25;box-shadow:0 0 16px var(--accent-glow)}.btn-preview{background:rgba(255,255,255,.06);color:var(--text-secondary);border:1px solid var(--border)}.btn-preview:hover{background:rgba(255,255,255,.1);color:var(--text-primary)}
.load-more-container{text-align:center;padding:20px 48px 60px}.btn-load-more{padding:14px 48px;border:1px solid var(--border);border-radius:12px;background:var(--bg-card);color:var(--text-secondary);font-size:.95rem;font-weight:600;cursor:pointer;transition:all .25s;font-family:inherit;letter-spacing:.5px}.btn-load-more:hover{border-color:var(--accent);color:var(--text-primary);box-shadow:0 0 20px var(--accent-glow);background:var(--bg-card-hover)}
.skeleton{background:linear-gradient(90deg,var(--bg-card) 25%,#1e1e32 50%,var(--bg-card) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:14px}@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}.skeleton-card{flex:0 0 340px;height:260px;border-radius:14px}
.generating-overlay{display:none;position:fixed;inset:0;z-index:200;background:rgba(10,10,15,.92);backdrop-filter:blur(16px);flex-direction:column;align-items:center;justify-content:center}.generating-overlay.active{display:flex}.gen-spinner{width:56px;height:56px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin-bottom:28px}@keyframes spin{to{transform:rotate(360deg)}}.gen-text{font-size:1.1rem;color:var(--text-secondary);margin-bottom:8px}.gen-agent{font-family:'Bebas Neue',sans-serif;font-size:1.6rem;color:var(--accent);letter-spacing:2px}.gen-progress{width:300px;height:3px;background:var(--border);border-radius:2px;margin-top:24px;overflow:hidden}.gen-progress-bar{height:100%;background:var(--accent);border-radius:2px;width:0%;transition:width .5s ease}
.result-modal{display:none;position:fixed;inset:0;z-index:300;background:rgba(10,10,15,.95);backdrop-filter:blur(20px);overflow-y:auto;padding:60px 48px}.result-modal.active{display:block}.result-close{position:fixed;top:24px;right:36px;width:44px;height:44px;border:1px solid var(--border);border-radius:50%;background:var(--bg-card);color:var(--text-primary);font-size:1.2rem;cursor:pointer;z-index:310;display:flex;align-items:center;justify-content:center;transition:all .2s}.result-close:hover{border-color:var(--accent);color:var(--accent)}.result-content{max-width:800px;margin:0 auto}.result-content h2{font-family:'Bebas Neue',sans-serif;font-size:2.4rem;letter-spacing:2px;margin-bottom:8px}.result-content .result-topic{color:var(--accent);font-size:1rem;margin-bottom:32px}.result-tabs{display:flex;gap:4px;margin-bottom:24px}.result-tab{padding:10px 20px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--text-muted);font-size:.85rem;cursor:pointer;transition:all .2s;font-family:inherit;font-weight:600}.result-tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}.result-tab:hover:not(.active){border-color:#444;color:var(--text-primary)}.result-output{background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:24px;white-space:pre-wrap;word-wrap:break-word;font-size:.88rem;line-height:1.7;color:var(--text-secondary);max-height:600px;overflow-y:auto}.result-metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px}.metric-box{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:18px;text-align:center}.metric-val{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--accent);letter-spacing:1px}.metric-label{font-size:.7rem;color:var(--text-muted);letter-spacing:.5px;text-transform:uppercase;margin-top:4px}
.empty-state{text-align:center;padding:80px 20px}.empty-state .icon{font-size:3rem;margin-bottom:16px;opacity:.3}.empty-state p{color:var(--text-muted);font-size:1rem}
@media(max-width:768px){.topnav,.section-header,.scroll-row,.load-more-container{padding-left:20px;padding-right:20px}.hero{padding:120px 20px 40px}.hero h1{font-size:2.6rem}.topic-card{flex:0 0 280px;min-height:240px}.manual-input{flex-direction:column;padding:12px}.manual-input input{width:100%;padding:10px 0}.result-modal{padding:60px 20px}.result-metrics{grid-template-columns:repeat(2,1fr)}}
/* ─── VIDEO PICKER ─── */
.btn-video{background:rgba(0,212,255,.12);color:var(--accent-secondary);border:1px solid rgba(0,212,255,.2)}.btn-video:hover{background:rgba(0,212,255,.2);color:#fff;box-shadow:0 0 12px rgba(0,212,255,.2)}
.video-modal{display:none;position:fixed;inset:0;z-index:250;background:rgba(10,10,15,.95);backdrop-filter:blur(20px);overflow-y:auto;padding:40px 24px}.video-modal.active{display:block}.video-modal-inner{max-width:960px;margin:0 auto}.video-modal-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:28px}.video-modal-title{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:2px}.video-modal-title .topic-label{display:block;color:var(--accent);font-family:'DM Sans',sans-serif;font-size:.85rem;font-weight:600;letter-spacing:.5px;margin-top:4px}.video-close{width:44px;height:44px;border:1px solid var(--border);border-radius:50%;background:var(--bg-card);color:var(--text-primary);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}.video-close:hover{border-color:var(--accent);color:var(--accent)}.video-search-bar{display:flex;gap:10px;margin-bottom:24px}.video-search-bar input{flex:1;padding:12px 18px;border:1px solid var(--border);border-radius:10px;background:var(--bg-card);color:var(--text-primary);font-size:.95rem;font-family:inherit;outline:none}.video-search-bar input:focus{border-color:var(--accent)}.video-search-bar button{padding:12px 24px;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;font-size:.85rem;cursor:pointer;font-family:inherit;white-space:nowrap;transition:all .2s}.video-search-bar button:hover{background:#ff1a25;box-shadow:0 0 16px var(--accent-glow)}.video-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.video-option{background:var(--bg-card);border:2px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:all .3s}.video-option:hover{border-color:rgba(229,9,20,.4);box-shadow:0 8px 30px rgba(0,0,0,.4);transform:translateY(-2px)}.video-option.selected{border-color:var(--accent);box-shadow:0 0 20px var(--accent-glow)}.video-thumb{position:relative;width:100%;aspect-ratio:16/9;background:#0f0f1a;overflow:hidden}.video-thumb img{width:100%;height:100%;object-fit:cover}.video-thumb .duration-badge{position:absolute;bottom:8px;right:8px;padding:2px 8px;border-radius:4px;background:rgba(0,0,0,.8);color:#fff;font-size:.7rem;font-weight:700}.video-thumb .platform-badge{position:absolute;top:8px;left:8px;padding:3px 8px;border-radius:5px;font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px}.plat-youtube{background:rgba(255,0,0,.3);color:#ff4444;border:1px solid rgba(255,0,0,.3)}.plat-twitter{background:rgba(29,155,240,.25);color:#1d9bf0;border:1px solid rgba(29,155,240,.3)}.plat-web{background:rgba(0,212,255,.2);color:var(--accent-secondary);border:1px solid rgba(0,212,255,.3)}.plat-vimeo{background:rgba(26,183,234,.25);color:#1ab7ea;border:1px solid rgba(26,183,234,.3)}.plat-tiktok{background:rgba(254,44,85,.25);color:#fe2c55;border:1px solid rgba(254,44,85,.3)}.video-info{padding:14px 16px}.video-info .v-title{font-weight:700;font-size:.88rem;line-height:1.35;margin-bottom:6px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.video-info .v-meta{font-size:.72rem;color:var(--text-muted);display:flex;align-items:center;gap:8px;flex-wrap:wrap}.video-info .v-channel{color:var(--text-secondary);font-weight:600}.video-actions-bar{display:flex;gap:10px;justify-content:flex-end;margin-top:24px;padding-top:20px;border-top:1px solid var(--border)}.btn-select-video{padding:14px 32px;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;font-size:.95rem;cursor:pointer;font-family:inherit;transition:all .2s;letter-spacing:.3px}.btn-select-video:hover{background:#ff1a25;box-shadow:0 0 20px var(--accent-glow)}.btn-select-video:disabled{opacity:.4;cursor:not-allowed;box-shadow:none}.btn-skip-video{padding:14px 24px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--text-secondary);font-weight:600;font-size:.9rem;cursor:pointer;font-family:inherit;transition:all .2s}.btn-skip-video:hover{border-color:#555;color:var(--text-primary)}.video-loading-msg{text-align:center;padding:40px 0;color:var(--text-muted);font-size:.95rem}.video-loading-msg .spin{display:inline-block;width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin-right:10px;vertical-align:middle}.video-dl-overlay{position:absolute;inset:0;background:rgba(10,10,15,.9);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:5;border-radius:14px}.video-dl-overlay .dl-text{font-size:.85rem;color:var(--text-secondary);margin-bottom:8px}.video-dl-overlay .dl-bar{width:60%;height:3px;background:var(--border);border-radius:2px;overflow:hidden}.video-dl-overlay .dl-bar-inner{height:100%;background:var(--accent);width:0%;transition:width .3s;border-radius:2px}
@media(max-width:768px){.video-modal{padding:20px 16px}.video-grid{grid-template-columns:1fr}.video-modal-title{font-size:1.5rem}}
</style>
</head>
<body>
<nav class="topnav" id="topnav"><a href="/" class="logo">AJ<span>ENGINE</span></a><div class="nav-links"><a href="/" class="active">Discover</a><a href="/dashboard">Campaigns</a><a href="/api/health">System</a></div></nav>
<section class="hero"><div class="hero-content">
<div class="hero-badge"><span class="dot"></span> LIVE &#8212; 7 SOURCES · AI NEWS FEED · VIDEO RESEARCH</div>
<h1>DISCOVER. <span class="red">GENERATE.</span> PUBLISH.</h1>
<p>AI news from Google, Reddit, HackerNews, Product Hunt, ArXiv, Twitter/X, and 10 RSS blogs &#8212; all in one feed. Pick a story, find a video, and launch 6 AI agents to create a full content campaign.</p>
<div class="manual-input"><input type="text" id="manualTopic" placeholder="Or type your own topic..."><button class="btn-generate" onclick="generateFromInput()">Generate &#8594;</button></div>
</div></section>
<div id="feedContainer"></div>
<div class="load-more-container"><button class="btn-load-more" id="loadMoreBtn" onclick="loadMore()">Load More Trending Topics</button></div>
<div class="generating-overlay" id="genOverlay"><div class="gen-spinner"></div><div class="gen-text">Agents are working on your campaign</div><div class="gen-agent" id="genAgent">RESEARCH AGENT</div><div class="gen-progress"><div class="gen-progress-bar" id="genBar"></div></div></div>
<!-- VIDEO PICKER MODAL -->
<div class="video-modal" id="videoModal"><div class="video-modal-inner"><div class="video-modal-header"><div class="video-modal-title">FIND A VIDEO<span class="topic-label" id="videoTopicLabel"></span></div><button class="video-close" onclick="closeVideoPicker()">&#10005;</button></div><div class="video-search-bar"><input type="text" id="videoSearchInput" placeholder="Search for videos..."><button onclick="searchVideosFromInput()">&#128269; Search</button></div><div class="video-grid" id="videoGrid"></div><div class="video-actions-bar"><button class="btn-skip-video" onclick="closeVideoPicker()">Skip &#8212; No Video</button><button class="btn-select-video" id="btnSelectVideo" onclick="confirmVideoSelection()" disabled>&#127909; Use This Video</button></div></div></div>
<div class="result-modal" id="resultModal"><button class="result-close" onclick="closeResult()">&#10005;</button><div class="result-content"><h2>CAMPAIGN COMPLETE</h2><div class="result-topic" id="resultTopic"></div><div class="result-metrics" id="resultMetrics"></div><div class="result-tabs" id="resultTabs"></div><div class="result-output" id="resultOutput"></div></div></div>
<script>
let page=0,loading=false;
const CATEGORIES=[{key:'breaking',title:'BREAKING IN AI',icon:'&#9889;'},{key:'tools',title:'NEW AI TOOLS &amp; LAUNCHES',icon:'&#128736;&#65039;'},{key:'research',title:'AI RESEARCH &amp; PAPERS',icon:'&#129514;'},{key:'startups',title:'AI STARTUPS &amp; FUNDING',icon:'&#128640;'},{key:'community',title:'TRENDING IN COMMUNITY',icon:'&#128293;'}];
window.addEventListener('scroll',()=>{document.getElementById('topnav').classList.toggle('scrolled',window.scrollY>40)});
document.addEventListener('DOMContentLoaded',()=>{showSkeletons();loadTrending()});
function showSkeletons(){document.getElementById('feedContainer').innerHTML=CATEGORIES.map(c=>`<div class="feed-section"><div class="section-header"><div class="section-title"><span class="icon">${c.icon}</span> ${c.title}</div></div><div class="scroll-row">${Array(5).fill('<div class="skeleton skeleton-card"></div>').join('')}</div></div>`).join('')}
async function loadTrending(){loading=true;try{const r=await fetch('/api/trending?page='+page);const d=await r.json();renderFeed(d);page++}catch(e){console.error('Feed error:',e);showFallback()}loading=false}
async function loadMore(){if(loading)return;const b=document.getElementById('loadMoreBtn');b.textContent='Loading...';b.style.pointerEvents='none';await loadTrending();b.textContent='Load More Trending Topics';b.style.pointerEvents='auto'}
function renderFeed(data){const c=document.getElementById('feedContainer');if(page===0)c.innerHTML='';const cat={};CATEGORIES.forEach(x=>cat[x.key]=[]);(data.topics||[]).forEach(t=>{const k=t.category||'breaking';if(cat[k])cat[k].push(t);else cat['breaking'].push(t)});CATEGORIES.forEach(x=>{const topics=cat[x.key];if(!topics.length)return;const s=document.createElement('div');s.className='feed-section';s.innerHTML=`<div class="section-header"><div class="section-title"><span class="icon">${x.icon}</span> ${x.title} <span class="count">${topics.length} stories</span></div></div><div class="scroll-row">${topics.map((t,i)=>renderCard(t,i)).join('')}</div>`;c.appendChild(s)})}
function renderCard(topic,idx){const sc={serper:'source-serper',reddit:'source-reddit',hackernews:'source-hackernews',rss:'source-rss',twitter:'source-twitter',producthunt:'source-producthunt',arxiv:'source-arxiv'}[topic.source]||'source-serper';const ic={serper:'\uD83D\uDD0D',reddit:'\uD83E\uDD16',hackernews:'\uD83D\uDCF0',rss:'\uD83D\uDCE1',twitter:'\uD83D\uDC26',producthunt:'\uD83D\uDE80',arxiv:'\uD83D\uDCC4'};const em=ic[topic.source]||'\uD83D\uDCF0';const pe=['\uD83E\uDD16','\uD83E\uDDE0','\u26A1','\uD83D\uDD2E','\uD83D\uDCA1','\uD83D\uDEE0\uFE0F','\uD83D\uDE80','\uD83D\uDD2C'][idx%8];return`<div class="topic-card" style="animation:fadeSlide .4s ease ${idx*.06}s both"><div class="card-image">${topic.image?`<img src="${topic.image}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='<div class=placeholder>${pe}</div>'">`:`<div class="placeholder">${pe}</div>`}<div class="card-gradient"></div><div class="card-source-badge ${sc}">${em} ${topic.source_name||topic.source||'web'}</div>${topic.score?`<div class="card-score">\u25B2 ${topic.score}</div>`:''}</div><div class="card-body"><div class="card-title">${escHtml(topic.title)}</div><div class="card-meta"><span>${topic.time_ago||'Recent'}</span>${topic.subreddit?`<span>r/${topic.subreddit}</span>`:''}</div><div class="card-why">${escHtml(topic.why_trending||topic.snippet||'')}</div><div class="card-actions"><button class="btn-card btn-campaign" onclick="event.stopPropagation();generate('${escAttr(topic.title)}')">\u26A1 Generate</button><button class="btn-card btn-video" onclick="event.stopPropagation();openVideoPicker('${escAttr(topic.title)}')">\uD83C\uDFAC Video</button><button class="btn-card btn-preview" onclick="event.stopPropagation();window.open('${topic.url||'#'}','_blank')">\u2197 Source</button></div></div></div>`}
function showFallback(){document.getElementById('feedContainer').innerHTML=`<div class="empty-state"><div class="icon">\uD83D\uDCE1</div><p>Could not load trending topics. Use the search bar above to generate a campaign manually.</p></div>`}
async function generate(topic){if(!topic)return;const o=document.getElementById('genOverlay'),a=document.getElementById('genAgent'),b=document.getElementById('genBar');o.classList.add('active');document.body.style.overflow='hidden';const agents=[{n:'RESEARCH AGENT',p:15},{n:'WRITER AGENT',p:35},{n:'REPURPOSER AGENT',p:55},{n:'VISUAL AGENT',p:72},{n:'PUBLISHER AGENT',p:88},{n:'ANALYTICS AGENT',p:95}];let s=0;const iv=setInterval(()=>{if(s<agents.length){a.textContent=agents[s].n;b.style.width=agents[s].p+'%';s++}},10000);try{const r=await fetch('/api/campaign/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({topic})});const d=await r.json();clearInterval(iv);b.style.width='100%';setTimeout(()=>{o.classList.remove('active');document.body.style.overflow='';b.style.width='0%';showResult(d)},500)}catch(e){clearInterval(iv);o.classList.remove('active');document.body.style.overflow='';b.style.width='0%';alert('Generation failed: '+e.message)}}
function generateFromInput(){const t=document.getElementById('manualTopic').value.trim();if(!t){document.getElementById('manualTopic').focus();return}generate(t)}
function showResult(data){const m=document.getElementById('resultModal');document.getElementById('resultTopic').textContent=data.topic||data.result?.topic||'';const mt=data.result?.metrics||{};document.getElementById('resultMetrics').innerHTML=`<div class="metric-box"><div class="metric-val">${mt.total_agents||'?'}</div><div class="metric-label">Agents</div></div><div class="metric-box"><div class="metric-val">${mt.total_tasks||'?'}</div><div class="metric-label">Tasks</div></div><div class="metric-box"><div class="metric-val">${mt.latency_seconds||'?'}s</div><div class="metric-label">Time</div></div><div class="metric-box"><div class="metric-val">8</div><div class="metric-label">Platforms</div></div>`;const o=data.result?.task_outputs||[];document.getElementById('resultTabs').innerHTML=o.map((x,i)=>`<button class="result-tab ${i===0?'active':''}" onclick="switchTab(${i})">${x.agent}</button>`).join('');window._ro=o;if(o.length)document.getElementById('resultOutput').textContent=o[0].output||'N/A';m.classList.add('active');document.body.style.overflow='hidden'}
function switchTab(i){document.querySelectorAll('.result-tab').forEach((t,j)=>t.classList.toggle('active',j===i));document.getElementById('resultOutput').textContent=window._ro[i]?.output||'N/A'}
function closeResult(){document.getElementById('resultModal').classList.remove('active');document.body.style.overflow=''}
function escHtml(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function escAttr(s){return(s||'').replace(/'/g,"\\'").replace(/"/g,'\\"')}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeResult();if(e.key==='Enter'&&document.activeElement?.id==='manualTopic')generateFromInput()});
const st=document.createElement('style');st.textContent='@keyframes fadeSlide{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}';document.head.appendChild(st);
/* === VIDEO RESEARCH & PICKER MODULE === */
let selectedVideoUrl=null,selectedVideoDownloadUrl=null,currentVideoTopic='';
function openVideoPicker(topic){currentVideoTopic=topic;selectedVideoUrl=null;selectedVideoDownloadUrl=null;const modal=document.getElementById('videoModal');document.getElementById('videoSearchInput').value=topic;document.getElementById('videoGrid').innerHTML='';document.getElementById('btnSelectVideo').disabled=true;modal.classList.add('active');document.body.style.overflow='hidden';searchVideos(topic)}
function closeVideoPicker(){document.getElementById('videoModal').classList.remove('active');document.body.style.overflow='';selectedVideoUrl=null;selectedVideoDownloadUrl=null;currentVideoTopic=''}
async function searchVideos(query){if(!query)return;const grid=document.getElementById('videoGrid');grid.innerHTML='<div class="video-loading-msg" style="grid-column:1/-1"><span class="spin"></span>Searching YouTube, Google, Twitter for videos...</div>';document.getElementById('btnSelectVideo').disabled=true;selectedVideoUrl=null;try{const resp=await fetch('/api/videos/search',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({topic:query,max_results:5})});const data=await resp.json();if(data.error)throw new Error(data.error);renderVideoOptions(data.videos||[])}catch(e){grid.innerHTML=`<div class="video-loading-msg" style="grid-column:1/-1">\u26A0\uFE0F Video search failed: ${escHtml(e.message)}<br><small style="color:var(--text-muted)">Try a different search term</small></div>`}}
function searchVideosFromInput(){const q=document.getElementById('videoSearchInput').value.trim();if(q)searchVideos(q)}
function renderVideoOptions(videos){const grid=document.getElementById('videoGrid');if(!videos.length){grid.innerHTML='<div class="video-loading-msg" style="grid-column:1/-1">No videos found. Try adjusting your search terms.</div>';return}grid.innerHTML=videos.map((v,i)=>{const isPexels=v.platform==='Pexels';const platClass={'YouTube':'plat-youtube','Twitter/X':'plat-twitter','Vimeo':'plat-vimeo','TikTok':'plat-tiktok','Pexels':'plat-web'}[v.platform]||'plat-web';const platIcon={'YouTube':'\u25B6','Twitter/X':'\uD835\uDD4F','Vimeo':'\u25B7','TikTok':'\u266A'}[v.platform]||'\uD83C\uDF10';return`<div class="video-option" id="vopt-${v.id}" onclick="selectVideo('${v.id}','${escAttr(v.url)}','${escAttr(v.download_url||'')}',this)" style="animation:fadeSlide .3s ease ${i*.06}s both"><div class="video-thumb">${v.thumbnail?`<img src="${v.thumbnail}" alt="" loading="lazy" onerror="this.style.display='none'">`:''}${v.duration_str&&v.duration_str!=='?'?`<div class="duration-badge">${v.duration_str}</div>`:''}<div class="platform-badge ${platClass}">${platIcon} ${v.platform}</div></div>${isPexels?'<div style="position:absolute;bottom:8px;left:8px;padding:2px 8px;border-radius:4px;background:rgba(0,200,100,.85);color:#fff;font-size:.6rem;font-weight:700">✓ DOWNLOADABLE</div>':''}<div class="video-info"><div class="v-title">${escHtml(v.title)}</div><div class="v-meta"><span class="v-channel">${escHtml(v.channel)}</span>${v.views_str?`<span>${v.views_str}</span>`:''}${v.upload_date?`<span>${v.upload_date}</span>`:''}</div></div></div>`}).join('')}
function selectVideo(id,url,downloadUrl,el){document.querySelectorAll('.video-option').forEach(v=>v.classList.remove('selected'));el.classList.add('selected');selectedVideoUrl=url;selectedVideoDownloadUrl=downloadUrl||'';document.getElementById('btnSelectVideo').disabled=false}
async function confirmVideoSelection(){if(!selectedVideoUrl)return;const btn=document.getElementById('btnSelectVideo');btn.textContent='\u23F3 Downloading & Hosting...';btn.disabled=true;const selectedCard=document.querySelector('.video-option.selected');if(selectedCard){const overlay=document.createElement('div');overlay.className='video-dl-overlay';overlay.innerHTML='<div class="dl-text">Downloading & uploading to Supabase...</div><div class="dl-bar"><div class="dl-bar-inner" id="dlBarInner"></div></div>';selectedCard.style.position='relative';selectedCard.appendChild(overlay);let pct=0;const iv=setInterval(()=>{pct=Math.min(pct+Math.random()*8,92);const bar=document.getElementById('dlBarInner');if(bar)bar.style.width=pct+'%'},800);window._dlInterval=iv}try{const resp=await fetch('/api/videos/select',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(Object.assign({url:selectedVideoUrl},selectedVideoDownloadUrl?{download_url:selectedVideoDownloadUrl}:{}))}});const data=await resp.json();clearInterval(window._dlInterval);if(data.status==='success'&&data.supabase_url){const bar=document.getElementById('dlBarInner');if(bar)bar.style.width='100%';setTimeout(()=>{closeVideoPicker();showVideoSuccess(currentVideoTopic,data)},600)}else if(data.status==='downloaded'){closeVideoPicker();alert('Video downloaded but Supabase upload failed. Check your SUPABASE_URL and SUPABASE_KEY.')}else{throw new Error(data.error||'Unknown error')}}catch(e){clearInterval(window._dlInterval);const overlay=document.querySelector('.video-dl-overlay');if(overlay)overlay.remove();btn.textContent='\uD83C\uDFAC Use This Video';btn.disabled=false;alert('Video download failed: '+e.message)}}
function showVideoSuccess(topic,data){const toast=document.createElement('div');toast.style.cssText='position:fixed;bottom:32px;right:32px;z-index:400;background:#1a1a2e;border:1px solid var(--accent);border-radius:14px;padding:20px 24px;max-width:420px;box-shadow:0 12px 40px rgba(229,9,20,.2);animation:fadeSlide .4s ease';toast.innerHTML=`<div style="font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:1px;color:var(--accent);margin-bottom:8px">\u2705 VIDEO HOSTED</div><div style="font-size:.85rem;color:var(--text-secondary);margin-bottom:6px">${escHtml(topic)}</div><div style="font-size:.75rem;color:var(--text-muted);margin-bottom:10px">${data.size_mb?data.size_mb+' MB':''} \u2192 Supabase Storage</div><a href="${data.supabase_url}" target="_blank" style="color:var(--accent-secondary);font-size:.8rem;word-break:break-all">View hosted video \u2197</a><button onclick="this.parentElement.remove()" style="position:absolute;top:8px;right:12px;background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:1rem">\u2715</button>`;document.body.appendChild(toast);setTimeout(()=>toast.remove(),12000)}
document.addEventListener('keydown',e=>{if(e.key==='Escape'&&document.getElementById('videoModal').classList.contains('active'))closeVideoPicker();if(e.key==='Enter'&&document.activeElement?.id==='videoSearchInput')searchVideosFromInput()});
</script>
</body>
</html>